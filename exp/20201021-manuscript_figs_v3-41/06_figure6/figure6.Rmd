---
title: "Figure4"
author: "Deepak Tanwar"
date: "<b>Created on:</b> 2020-10-14 <br> <b>Updated on:</b> `r Sys.Date()`"
output:
  rmdformats::readthedown:
    highlight: tango
    self_contained: true
    thumbnails: true
    lightbox: true
    gallery: false
    keep_md: no
    number_sections: no
    fig_width: 8
    fig_height: 8
    fig_caption: true
    df_print: paged
    code_folding: hide
  fontsize: 12pt
  geometry: margin=1in
  documentclass: article
# bibliography: references.bib
link-citations: yes
---


# Libraries and functions
```{r}
source("../bin/functions.R")
```


# C
```{r}
files <- lapply(1:5, function(x) data.frame(read_xlsx("input/Table.S6_Dev_Paper_Transposable.elements_HOMER.xlsx", sheet = x)[,1:5]))

names(files) <- readxl::excel_sheets("input/Table.S6_Dev_Paper_Transposable.elements_HOMER.xlsx")

tf_pos <- ldply(files[3:5], .id = "Group")

tf_pos$Genes <- str_to_title(tolower(gsub(pattern = "_.*", replacement = "", x = tf_pos$Motif.Name)))
tf_pos$Motif <- gsub(pattern = "_.*", replacement = "", x = tf_pos$Motif.Name)

tf_pos$Group <- paste(tf_pos$Group, "in adult spermatogonial cells")

load("input/limma_SC_Controls_lab_lit.RData")
dea <- dea.limma$`pnd14 vs pnw8`

tf_dea_pos <- merge(tf_pos, dea)

tf_dea_pos$q.value..Benjamini.[tf_dea_pos$q.value..Benjamini. == 0] <- 0.00001

tf_dea_pos$Group <- plgINS::breakStrings(x = tf_dea_pos$Group, minSizeForBreak = 25)

c <- ggplot(tf_dea_pos, aes(x = Motif, y = Group)) +
  geom_point(aes(size = -log10(q.value..Benjamini.), color = logFC), alpha = 0.6) +
  scale_colour_gradient2(low = "#313695", mid = "grey", high = "#A50026", limits = c(floor(min(tf_dea_pos$logFC)), ceiling(max(tf_dea_pos$logFC))), breaks = c(-5, 0, 5)) +
  # scale_colour_gradientn(colors = c("#BC3C29FF","grey", "#0072B5FF"), guide=guide_colorbar(reverse=FALSE))+
  xlab("") +
  ylab("") +
  theme_bw(base_family = "Helvetica") +
  th +
  theme(
    axis.text.x = element_text(hjust = 1, vjust = 0.5, angle = 90),
    legend.title.align = 0.5
  ) +
  labs(color = expression(Log[2] ~ FC ~ "(RNA-seq)"), size = expression(-Log[10] ~ adjusted ~ italic(P) ~ "(Motif enrichment)")) +
  guides(
    colour = guide_colorbar(
      nrow = 1, order = 1,
      title.position = "top", title.hjust = 0.5, title.vjust = 0.5,
      barwidth = unit(2, "cm"), barheight = unit(0.3, "cm"),
      label.hjust = 0.5, label.vjust = 0.5, size = 8
    ),
    size = guide_legend(
      title.position = "top",
      title.hjust = 0.5, title.vjust = 0.5,
      nrow = 1, size = 8,
      order = 2,
      label.hjust = 0.5, label.vjust = 0.5
    )
  ) +theme(legend.spacing = unit(0.5, "cm"))

cg <- gridExtra::grid.arrange(egg::set_panel_size(p = c, width = unit(17.25, "cm"), height = unit(2.5, "cm")))
ggsave(plot = cg, filename = "output/c.pdf", width = unit(8.5, "in"), height = unit(11, "in"), dpi = 320)
```


# A
```{r}
tf_neg <- ldply(files[1:2], .id = "Group")

tf_neg$Genes <- str_to_title(tolower(gsub(pattern = "_.*", replacement = "", x = tf_neg$Motif.Name)))
tf_neg$Motif <- gsub(pattern = "_.*", replacement = "", x = tf_neg$Motif.Name)

tf_neg$Group <- paste(tf_neg$Group, "in adult spermatogonial cells")

tf_dea_neg <- merge(tf_neg, dea)

tf_dea_neg$q.value..Benjamini.[tf_dea_neg$q.value..Benjamini. == 0] <- 0.00001
tf_dea_neg$Group <- plgINS::breakStrings(x = tf_dea_neg$Group, minSizeForBreak = 25)

a <- ggplot(tf_dea_neg, aes(x = Motif, y = Group)) +
  geom_point(aes(size = -log10(q.value..Benjamini.), color = logFC), alpha = 0.6) +
  scale_colour_gradient2(low = "#313695", mid = "grey", high = "#A50026", limits = c(floor(min(tf_dea_neg$logFC)), ceiling(max(tf_dea_neg$logFC))), breaks = c(-5, 0, 5)) +
  # scale_colour_gradientn(colors = c("#BC3C29FF","grey", "#0072B5FF"), guide=guide_colorbar(reverse=FALSE))+
  xlab("") +
  ylab("") +
  theme_bw(base_family = "Helvetica") +
  th +
  theme(
    axis.text.x = element_text(hjust = 1, vjust = 0.5, angle = 90),
    legend.title.align = 0.5
  ) +
  labs(color = expression(Log[2] ~ FC ~ "(RNA-seq)"), size = expression(-Log[10] ~ adjusted ~ italic(P) ~ "(Motif enrichment)")) +
  guides(
    colour = guide_colorbar(
      nrow = 1, order = 1,
      title.position = "top", title.hjust = 0.5, title.vjust = 0.5,
      barwidth = unit(2, "cm"), barheight = unit(0.3, "cm"),
      label.hjust = 0.5, label.vjust = 0.5, size = 8
    ),
    size = guide_legend(
      title.position = "top",
      title.hjust = 0.5, title.vjust = 0.5,
      nrow = 1, size = 8,
      order = 2,
      label.hjust = 0.5, label.vjust = 0.5
    )
  )+theme(legend.spacing = unit(0.5, "cm"))

ag <- gridExtra::grid.arrange(egg::set_panel_size(p = a, width = unit(17.25, "cm"), height = unit(2.5, "cm")))
ggsave(plot = ag, filename = "output/a.pdf", width = unit(8.5, "in"), height = unit(11, "in"), dpi = 320)
```




# References
```{r overlap-matrix-rGREAT-43 }
report::cite_packages(session = sessionInfo())
```

# SessionInfo
```{r overlap-matrix-rGREAT-44 }
devtools::session_info() %>%
  details::details()
```
